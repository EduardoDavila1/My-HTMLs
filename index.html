<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ed Studios | Universe Hub</title>
    <style>
        :root {
            --neon-blue: #00f3ff;
            --glass-bg: rgba(0, 0, 0, 0.8);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            overflow: hidden;
            background-color: #000;
            font-family: 'Courier New', Courier, monospace;
            color: white;
            touch-action: none;
        }

        /* Lienzo 3D */
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;
        }

        /* --- DEBUGGER (Para saber si funciona) --- */
        #debug-console {
            position: fixed; bottom: 10px; left: 10px;
            color: lime; font-size: 10px; z-index: 9999;
            background: rgba(0,0,0,0.5); padding: 5px;
            pointer-events: none;
            font-family: monospace;
        }

        /* --- PANTALLA INTRO --- */
        #intro-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 999;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: opacity 0.5s ease;
        }
        #start-btn {
            padding: 20px 40px;
            border: 2px solid var(--neon-blue);
            background: rgba(0, 243, 255, 0.1);
            color: var(--neon-blue);
            font-size: 1.2rem; font-weight: bold;
            cursor: pointer; text-transform: uppercase;
            box-shadow: 0 0 20px var(--neon-blue);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 10px var(--neon-blue); } 50% { box-shadow: 0 0 30px var(--neon-blue); } 100% { box-shadow: 0 0 10px var(--neon-blue); } }

        /* --- MENÚ MÓVIL --- */
        #menu-toggle {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: var(--glass-bg); border: 1px solid var(--neon-blue);
            color: var(--neon-blue); width: 50px; height: 50px;
            display: none; justify-content: center; align-items: center;
            border-radius: 8px; font-size: 1.8rem; cursor: pointer;
        }

        /* --- HUD --- */
        #hud {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%); z-index: 10;
            text-align: center; width: 100%; max-width: 500px;
            pointer-events: none;
        }
        .project-btn {
            pointer-events: auto; display: block; margin: 15px auto;
            padding: 18px 0; width: 80%;
            background: rgba(10, 10, 10, 0.85); border: 1px solid #333;
            color: #fff; text-decoration: none; font-size: 1.1rem;
            text-transform: uppercase; transition: 0.3s;
        }
        .project-btn:hover {
            border-color: var(--neon-blue); box-shadow: 0 0 15px var(--neon-blue);
        }

        @media (max-width: 768px) {
            #menu-toggle { display: flex; }
            #hud {
                top: 0; left: 0; transform: none; height: 100%;
                background: rgba(0,0,0,0.95);
                flex-direction: column; justify-content: center; display: flex;
                opacity: 0; pointer-events: none; transition: opacity 0.3s;
            }
            #hud.active { opacity: 1; pointer-events: auto; }
        }
    </style>
</head>
<body>

    <div id="debug-console">Esperando sensores...</div>

    <div id="intro-overlay">
        <button id="start-btn">INICIAR SISTEMA</button>
        <p style="margin-top:15px; color:#666; font-size:0.8rem;">Requiere acceso a sensores</p>
    </div>

    <div id="menu-toggle">☰</div>
    <div id="canvas-container"></div>

    <nav id="hud">
        <a href="gaia/index.html" class="project-btn">Gaia Universe</a>
        <a href="Antena.html" class="project-btn">Proyecto Antena</a>
        <a href="SharkTank.html" class="project-btn">Shark Tank</a>
        <a href="cv.pdf" class="project-btn">Expediente (CV)</a>
    </nav>

    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';

        let scene, camera, renderer, stars;
        let targetX = 0, targetY = 0;
        let currentX = 0, currentY = 0;
        let isMobile = false;
        
        const debug = document.getElementById('debug-console');
        const container = document.getElementById('canvas-container');
        const intro = document.getElementById('intro-overlay');
        const startBtn = document.getElementById('start-btn');

        // --- 1. THREE.JS SETUP ---
        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.002);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 20;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            container.appendChild(renderer.domElement);

            // Estrellas
            const geo = new THREE.BufferGeometry();
            const count = 5000;
            const pos = new Float32Array(count * 3);
            for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*1000;
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const mat = new THREE.PointsMaterial({size: 2, color: 0xffffff});
            stars = new THREE.Points(geo, mat);
            scene.add(stars);
        }

        // --- 2. LÓGICA DE SENSORES (HÍBRIDA) ---
        
        // Opción A: Giroscopio (Ideal)
        function handleOrientation(e) {
            const y = e.beta;  // Inclinación frontal (-180 a 180)
            const x = e.gamma; // Inclinación lateral (-90 a 90)

            if (x !== null && y !== null) {
                isMobile = true;
                // Sensibilidad x5
                targetX = x * 5; 
                targetY = (y - 45) * 5; // -45 para centrar
                debug.innerText = `GYRO: X:${x.toFixed(0)} Y:${y.toFixed(0)}`;
            }
        }

        // Opción B: Acelerómetro/Gravedad (Fallback para Android difícil)
        function handleMotion(e) {
            // Si el giroscopio ya funcionó, ignoramos esto
            if (isMobile && targetX !== 0) return;

            const acc = e.accelerationIncludingGravity;
            if (acc && acc.x !== null) {
                isMobile = true;
                // Convertir gravedad a posición
                // acc.x va de -9.8 a 9.8 aprox
                targetX = acc.x * -40; 
                targetY = acc.y * 40;
                debug.innerText = `ACCEL: X:${acc.x.toFixed(1)} Y:${acc.y.toFixed(1)}`;
            }
        }

        // --- 3. ANIMACIÓN ---
        function animate() {
            requestAnimationFrame(animate);
            stars.rotation.y += 0.0005;

            if (isMobile) {
                // Interpolación suave (Lerp)
                currentX += (targetX - currentX) * 0.05;
                currentY += (targetY - currentY) * 0.05;
                
                camera.position.x = currentX * 0.1;
                camera.position.y = -currentY * 0.1;
            }

            camera.lookAt(scene.position);
            renderer.render(scene, camera);
        }

        // --- 4. ARRANQUE DEL SISTEMA ---
        async function startSystem() {
            intro.style.opacity = '0';
            setTimeout(()=>intro.style.display='none', 500);
            
            init();
            animate();

            // Intentar TODO para activar sensores
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                // iOS
                try {
                    const perm = await DeviceOrientationEvent.requestPermission();
                    if (perm === 'granted') window.addEventListener('deviceorientation', handleOrientation);
                    else alert("Permiso denegado iOS");
                } catch(e) { console.log(e); }
            } else {
                // Android (Chrome)
                window.addEventListener('deviceorientation', handleOrientation);
                window.addEventListener('devicemotion', handleMotion);
            }
        }

        startBtn.addEventListener('click', startSystem);

        // UI Menú
        const menuBtn = document.getElementById('menu-toggle');
        const hud = document.getElementById('hud');
        let menuOpen = false;
        menuBtn.addEventListener('click', () => {
            menuOpen = !menuOpen;
            hud.classList.toggle('active', menuOpen);
            menuBtn.innerText = menuOpen ? '✕' : '☰';
        });

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
